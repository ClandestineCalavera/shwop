<!DOCTYPE html>

<html>
<head>
  <title>app.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="app.html">
                app.js
              </a>
            
              
              <a class="source" href="auth.html">
                auth.js
              </a>
            
              
              <a class="source" href="bid.html">
                bid.js
              </a>
            
              
              <a class="source" href="mybids.html">
                mybids.js
              </a>
            
              
              <a class="source" href="mystore.html">
                mystore.js
              </a>
            
              
              <a class="source" href="products.html">
                products.js
              </a>
            
              
              <a class="source" href="profile.html">
                profile.js
              </a>
            
              
              <a class="source" href="canvas-to-blob.html">
                canvas-to-blob.js
              </a>
            
              
              <a class="source" href="sell.html">
                sell.js
              </a>
            
              
              <a class="source" href="services.html">
                services.js
              </a>
            
              
              <a class="source" href="bidController.html">
                bidController.js
              </a>
            
              
              <a class="source" href="bidRoutes.html">
                bidRoutes.js
              </a>
            
              
              <a class="source" href="helpers.html">
                helpers.js
              </a>
            
              
              <a class="source" href="middleware.html">
                middleware.js
              </a>
            
              
              <a class="source" href="utils.html">
                utils.js
              </a>
            
              
              <a class="source" href="clear_db.html">
                clear_db.js
              </a>
            
              
              <a class="source" href="db_config.html">
                db_config.js
              </a>
            
              
              <a class="source" href="dummy_data.html">
                dummy_data.js
              </a>
            
              
              <a class="source" href="helpers.html">
                helpers.js
              </a>
            
              
              <a class="source" href="productController.html">
                productController.js
              </a>
            
              
              <a class="source" href="productRoutes.html">
                productRoutes.js
              </a>
            
              
              <a class="source" href="server.html">
                server.js
              </a>
            
              
              <a class="source" href="userController.html">
                userController.js
              </a>
            
              
              <a class="source" href="userRoutes.html">
                userRoutes.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>app.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>angular.module(<span class="hljs-string">'shwop'</span>, [
  <span class="hljs-string">'shwop.services'</span>,
  <span class="hljs-string">'shwop.products'</span>,
  <span class="hljs-string">'shwop.sell'</span>,
  <span class="hljs-string">'shwop.bid'</span>,
  <span class="hljs-string">'shwop.auth'</span>,
  <span class="hljs-string">'shwop.mystore'</span>,
  <span class="hljs-string">'shwop.mybids'</span>,
  <span class="hljs-string">'shwop.profile'</span>,
  <span class="hljs-string">'mobile-angular-ui'</span>,
  <span class="hljs-string">'mobile-angular-ui.gestures'</span>,
  <span class="hljs-string">'pascalprecht.translate'</span>,
  <span class="hljs-string">'ngRoute'</span>,
  <span class="hljs-string">'ngFitText'</span>
])
.controller(<span class="hljs-string">'SidebarController'</span>, [<span class="hljs-string">'$scope'</span>, <span class="hljs-string">'$translate'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">$scope, $translate</span>) </span>{
  $scope.toggleLanguage = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">lang</span>) </span>{
    $translate.use(lang);
  };
}])
.config([<span class="hljs-string">'$routeProvider'</span>, <span class="hljs-string">'$httpProvider'</span>, <span class="hljs-string">'$translateProvider'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">$routeProvider, $httpProvider, $translateProvider</span>) </span>{
  $routeProvider
    .when(<span class="hljs-string">'/'</span>, {
      templateUrl: <span class="hljs-string">'app/auth/signin.html'</span>,
      controller: <span class="hljs-string">'AuthController'</span>
    })
    .when(<span class="hljs-string">'/signin'</span>, {
      templateUrl: <span class="hljs-string">'app/auth/signin.html'</span>,
      controller: <span class="hljs-string">'AuthController'</span>
    })
    .when(<span class="hljs-string">'/signup'</span>, {
      templateUrl: <span class="hljs-string">'app/auth/signup.html'</span>,
      controller: <span class="hljs-string">'AuthController'</span>
    })
    .when(<span class="hljs-string">'/products'</span>, {
      templateUrl: <span class="hljs-string">'app/products/products.html'</span>,
      controller: <span class="hljs-string">'ProductController'</span>,
      css: <span class="hljs-string">'../styles/style.css'</span>,
      authenticate: <span class="hljs-literal">true</span>
    })
    .when(<span class="hljs-string">'/sell'</span>, {
      templateUrl: <span class="hljs-string">'app/sell/sell.html'</span>,
      controller: <span class="hljs-string">'SellController'</span>,
      css: <span class="hljs-string">'../styles/style.css'</span>,
      authenticate: <span class="hljs-literal">true</span>
    })
    .when(<span class="hljs-string">'/welcome'</span>, {
      templateUrl: <span class="hljs-string">'app/auth/welcome.html'</span>,
      controller: <span class="hljs-string">'AuthController'</span>,
      css: <span class="hljs-string">'../styles/style.css'</span>
    })
    .when(<span class="hljs-string">'/bid'</span>, {
      templateUrl: <span class="hljs-string">'app/bid/bid.html'</span>,
      controller: <span class="hljs-string">'BidController'</span>,
      css: <span class="hljs-string">'../styles/style.css'</span>,
      authenticate: <span class="hljs-literal">true</span>
    })
    .when(<span class="hljs-string">'/mystore'</span>, {
      templateUrl: <span class="hljs-string">'app/mystore/mystore.html'</span>,
      controller: <span class="hljs-string">'MyStoreController'</span>,
      css: <span class="hljs-string">'../styles/style.css'</span>,
      authenticate: <span class="hljs-literal">true</span>
    })
    .when(<span class="hljs-string">'/mybids'</span>, {
      templateUrl: <span class="hljs-string">'app/mybids/mybids.html'</span>,
      controller: <span class="hljs-string">'MyBidsController'</span>,
      css: <span class="hljs-string">'../styles/style.css'</span>,
      authenticate: <span class="hljs-literal">true</span>
    })
    .when(<span class="hljs-string">'/profile'</span>, {
      templateUrl: <span class="hljs-string">'app/profile/profile.html'</span>,
      controller: <span class="hljs-string">'ProfileController'</span>,
      css: <span class="hljs-string">'../styles/style.css'</span>,
      authenticate: <span class="hljs-literal">true</span>
    });


    $translateProvider.translations(<span class="hljs-string">'en'</span>, enUS);
    $translateProvider.translations(<span class="hljs-string">'es'</span>, esES);
    $translateProvider.preferredLanguage(<span class="hljs-string">'en'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>.when(‘/products:items’, {        // TODO: Syntax for filtered items
  templateUrl: ‘app/products/products.html’,
  controller: ‘ProductController’
});</p>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>We add our $httpInterceptor into the array
of interceptors. Think of it like middleware for your ajax calls</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $httpProvider.interceptors.push(<span class="hljs-string">'AttachTokens'</span>);
}])
.factory(<span class="hljs-string">'AttachTokens'</span>, [<span class="hljs-string">'$window'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">$window</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>this is an $httpInterceptor
its job is to stop all out going request
then look in local storage and find the user’s token
then add it to the header so the server can validate the request</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> attach = {
    request: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">object</span>) </span>{
      <span class="hljs-keyword">var</span> jwt = $<span class="hljs-built_in">window</span>.localStorage.getItem(<span class="hljs-string">'com.shwop'</span>);
      
      <span class="hljs-keyword">if</span> (!<span class="hljs-regexp">/(http(s?))\:\/\//gi</span>.test(object.url)){

        <span class="hljs-keyword">if</span> (jwt) {
          object.headers[<span class="hljs-string">'x-access-token'</span>] = jwt;
        }
        object.headers[<span class="hljs-string">'Allow-Control-Allow-Origin'</span>] = <span class="hljs-string">'*'</span>;
      }
      <span class="hljs-keyword">return</span> object;
    }
  };
  <span class="hljs-keyword">return</span> attach;
}])
.run([<span class="hljs-string">'$rootScope'</span>, <span class="hljs-string">'$location'</span>, <span class="hljs-string">'Auth'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">$rootScope, $location, Auth</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Here inside the run phase of angular, our services and controllers
have just been registered and our app is ready.
However, we want to make sure the user is authorized.
We listen for when angular is trying to change routes.
When it does change routes, we then look for the token in localstorage
and send that token to the server to see if it is a real user or hasn’t expired.
If it’s not valid, we then redirect back to signin/signup.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  $rootScope.$on(<span class="hljs-string">'$routeChangeStart'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">evt, next, current</span>) </span>{
    <span class="hljs-keyword">if</span> (next.$$route &amp;&amp; next.$$route.authenticate &amp;&amp; !Auth.isAuth()) {
      $location.path(<span class="hljs-string">'/signin'</span>);
    }
  });
  $rootScope.$on(<span class="hljs-string">'$routeChangeSuccess'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event, current</span>) </span>{
    <span class="hljs-keyword">if</span> (current.$$route.authenticate || Auth.isAuth()) {
      $rootScope.showSideBar = <span class="hljs-literal">true</span>;
    } <span class="hljs-keyword">else</span> {
      $rootScope.showSideBar = <span class="hljs-literal">false</span>;
    }
  });
}]);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
